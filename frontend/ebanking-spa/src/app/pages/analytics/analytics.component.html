<div class="analytics-page">
  <app-page-header
    title="Analytics"
    subtitle="Financial insights and trends based on your accounts and transactions"
    [breadcrumbs]="['Home', 'Analytics']">
  </app-page-header>

  @if (loading) {
    <div class="loading-container">
      <mat-spinner diameter="50"></mat-spinner>
      <p>Loading analytics...</p>
    </div>
  } @else {
    <div class="analytics-content">
      <!-- Summary Cards -->
      <div class="summary-cards">
        <mat-card class="stat-card">
          <div class="stat-icon" style="background: #EBF5FF;">
            <mat-icon style="color: #1E6AE1;">account_balance_wallet</mat-icon>
          </div>
          <div class="stat-content">
            <h3>Total Balance</h3>
            <p class="stat-value">{{ summary ? formatCurrency(summary.totalBalance) : '$0.00' }}</p>
            <span class="stat-label">{{ summary?.accountsCount || 0 }} accounts</span>
          </div>
        </mat-card>

        <mat-card class="stat-card">
          <div class="stat-icon" style="background: #D1FAE5;">
            <mat-icon style="color: #10B981;">trending_up</mat-icon>
          </div>
          <div class="stat-content">
            <h3>Total Income</h3>
            <p class="stat-value income">{{ summary ? formatCurrency(summary.totalIncome) : '$0.00' }}</p>
            <span class="stat-label">Last period</span>
          </div>
        </mat-card>

        <mat-card class="stat-card">
          <div class="stat-icon" style="background: #FEE2E2;">
            <mat-icon style="color: #EF4444;">trending_down</mat-icon>
          </div>
          <div class="stat-content">
            <h3>Total Expenses</h3>
            <p class="stat-value expense">{{ summary ? formatCurrency(summary.totalExpenses) : '$0.00' }}</p>
            <span class="stat-label">Last period</span>
          </div>
        </mat-card>

        <mat-card class="stat-card">
          <div class="stat-icon" style="background: #FEF3C7;">
            <mat-icon style="color: #F59E0B;">account_balance</mat-icon>
          </div>
          <div class="stat-content">
            <h3>Net Income</h3>
            <p class="stat-value" [class.positive]="summary && summary.netIncome >= 0" [class.negative]="summary && summary.netIncome < 0">
              {{ summary ? formatCurrency(summary.netIncome) : '$0.00' }}
            </p>
            <span class="stat-label">{{ summary?.transactionCount || 0 }} transactions</span>
          </div>
        </mat-card>
      </div>

      <!-- Charts Section -->
      <div class="charts-section">
        <!-- Income vs Expenses Chart -->
        <mat-card class="chart-card">
          <mat-card-header>
            <mat-card-title>
              <mat-icon>show_chart</mat-icon>
              Income vs Expenses
            </mat-card-title>
          </mat-card-header>
          <mat-card-content>
            @if (incomeExpensesChart) {
              <app-chart-widget
                title="Monthly Income vs Expenses"
                type="bar"
                [height]="300"
                [data]="incomeExpensesChart">
              </app-chart-widget>
            } @else {
              <div class="no-data">No data available</div>
            }
          </mat-card-content>
        </mat-card>

        <!-- Balance Evolution Chart -->
        <mat-card class="chart-card">
          <mat-card-header>
            <mat-card-title>
              <mat-icon>timeline</mat-icon>
              Balance Evolution
            </mat-card-title>
          </mat-card-header>
          <mat-card-content>
            @if (balanceEvolutionChart) {
              <app-chart-widget
                title="Account Balance Over Time"
                type="line"
                [height]="300"
                [data]="balanceEvolutionChart">
              </app-chart-widget>
            } @else {
              <div class="no-data">No data available</div>
            }
          </mat-card-content>
        </mat-card>
      </div>

      <!-- Category Spending Section -->
      <div class="category-section">
        <mat-card class="category-card">
          <mat-card-header>
            <mat-card-title>
              <mat-icon>pie_chart</mat-icon>
              Spending by Category
            </mat-card-title>
          </mat-card-header>
          <mat-card-content>
            @if (categorySpending.length > 0) {
              <div class="category-list">
                @for (category of categorySpending; track category.category) {
                  <div class="category-item">
                    <div class="category-info">
                      <div class="category-color" [style.background]="category.color"></div>
                      <span class="category-name">{{ formatCategoryName(category.category) }}</span>
                    </div>
                    <div class="category-stats">
                      <span class="category-amount">{{ formatCurrency(category.amount) }}</span>
                      <span class="category-percentage">{{ category.percentage.toFixed(1) }}%</span>
                    </div>
                    <div class="category-bar">
                      <div class="category-bar-fill" [style.width.%]="category.percentage" [style.background]="category.color"></div>
                    </div>
                  </div>
                }
              </div>
            } @else {
              <div class="no-data">No spending data available</div>
            }
          </mat-card-content>
        </mat-card>

        <!-- Category Chart -->
        <mat-card class="chart-card">
          <mat-card-header>
            <mat-card-title>
              <mat-icon>bar_chart</mat-icon>
              Category Breakdown
            </mat-card-title>
          </mat-card-header>
          <mat-card-content>
            @if (categoryChart) {
              <app-chart-widget
                title="Spending by Category"
                type="bar"
                [height]="300"
                [data]="categoryChart">
              </app-chart-widget>
            } @else {
              <div class="no-data">No data available</div>
            }
          </mat-card-content>
        </mat-card>
      </div>
    </div>
  }
</div>

